<div class="page-layout carded left-sidebar inner-scroll">

    <!-- SIDEBAR -->
    <cdk-sidebar class="sidebar" name="processo-main-sidebar" position="left"
                 [lockedOpen]="routerState.url.indexOf('apps/processo') > -1 ? 'gt-md' : 'gt-xl'">
        <processo-main-sidebar [@animate]="{value:'*'}"></processo-main-sidebar>
    </cdk-sidebar>

    <!-- / SIDEBAR -->

    <!-- CENTER -->
    <div class="center">

        <!-- CONTENT HEADER -->
        <div class="header" *ngIf="!(expandir$ | async)">
            <div class="search-wrapper" *ngIf="this._loginService.isGranted('ROLE_COLABORADOR') && processo?.id">
                <button class="sidebar-toggle" mat-icon-button *ngIf="routerState.url.indexOf('apps/processo') > -1"
                        matTooltip="Menu do processo"
                        (click)="toggleSidebar('processo-main-sidebar')" fxHide.gt-md>
                    <mat-icon>menu</mat-icon>
                </button>
                <button class="sidebar-toggle" mat-icon-button *ngIf="routerState.url.indexOf('apps/processo') === -1"
                        matTooltip="Menu do processo"
                        (click)="toggleSidebar('processo-main-sidebar')" fxHide.gt-xl>
                    <mat-icon>menu</mat-icon>
                </button>

                <div class="search">
                    <mat-icon class="secondary-text mr-8">label</mat-icon>
                    <cdk-vinculacao-etiqueta-chips
                        [placeholder]="'Adicionar etiquetas para o processo'"
                        [vinculacoesEtiquetas]="(processo$ | async)?.vinculacoesEtiquetas"
                        (create)="onEtiquetaCreate($event)"
                        (edit)="onEtiquetaEdit($event)"
                        [savingVinculacaoEtiquetaId]="(savingVinculacaoEtiquetaId$ | async)"
                        [errors]="(errors$ | async)"
                        [pagination]="vinculacaoEtiquetaPagination"
                        (delete)="onEtiquetaDelete($event)"></cdk-vinculacao-etiqueta-chips>
                </div>

            </div>

            <div class="spinner-container m-8" *ngIf="(togglingAcompanharProcesso$ | async) || (pluginLoading$ | async)?.length">
                <mat-spinner diameter="20"></mat-spinner>
            </div>

            <div class="actions" *ngIf="processo !== null">
                <button mat-icon-button [matMenuTriggerFor]="moreMenu" aria-label="Mais Ferramentas"
                        (click)="$event.stopPropagation()"
                        *ngIf="(processo$ | async) && (togglingAcompanharProcesso$ | async) === false && (pluginLoading$ | async)?.length === 0">
                    <mat-icon class="secondary-text">more_vert</mat-icon>
                </button>

                <mat-menu #moreMenu="matMenu">
                    <button mat-menu-item aria-label="arquivar processo"
                            *ngIf="!this._loginService.isGranted('ROLE_USUARIO_EXTERNO') && (processo$ | async)?.setorAtual?.nome !== 'ARQUIVO'"
                            (click)="arquivarProcesso()">
                        <ng-container>
                            <mat-icon>archive</mat-icon>
                            <span>Arquivar</span>
                        </ng-container>
                    </button>
                    <button mat-menu-item aria-label="imprimir etiqueta"
                            *showIfNotRole="'ROLE_USUARIO_EXTERNO'"
                            (click)="imprimirEtiqueta()">
                        <ng-container>
                            <mat-icon>video_label</mat-icon>
                            <span>Imprimir Etiqueta</span>
                        </ng-container>
                    </button>
                    <button mat-menu-item aria-label="Autuar"
                            *ngIf="this._loginService.isGranted('ROLE_COLABORADOR') && (processo$ | async)?.id && (processo$ | async)?.unidadeArquivistica !== 1"
                            (click)="doAutuar()">
                        <ng-container>
                            <mat-icon>check</mat-icon>
                            <span>Autuar</span>
                        </ng-container>
                    </button>
                    <button mat-menu-item aria-label="abrir nova aba" (click)="visualizarProcessoNovaAba()">
                        <ng-container>
                            <mat-icon>open_in_new</mat-icon>
                            <span>Abrir nova aba</span>
                        </ng-container>
                    </button>
                    <button mat-menu-item aria-label="alterar acompanhamento" *ngIf="processo" (click)="acompanharProcesso(processo)" >
                        <ng-container>
                            <mat-icon>done</mat-icon>
                            <span>{{!!processo.compartilhamentoUsuario ? 'Desacompanhar Processo'  : 'Acompanhar Processo'}}</span>
                        </ng-container>
                    </button>
                    <ng-template #dynamicComponent></ng-template>

                </mat-menu>
            </div>
        </div>
        <!-- / CONTENT HEADER -->

        <!-- CONTENT CARD -->
        <div class="content-card">
            <div class="content">
                <router-outlet></router-outlet>
            </div>
        </div>
        <!-- / CONTENT CARD -->

    </div>
    <!-- / CENTER -->

</div>
