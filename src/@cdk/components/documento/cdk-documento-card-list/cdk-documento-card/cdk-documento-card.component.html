<div fxLayout="row" fxLayoutAlign="start center">

    <mat-checkbox class="mr-8 ml-8 select" [checked]="selected"
                  (change)="toggleInSelected(documento.id)"
                  (click)="$event.stopPropagation();">
    </mat-checkbox>

    <div class="p-8 file" fxLayout="column" (click)="onClick(documento)"
         [ngClass]="{'light-blue-100':!documento.documentoAvulsoRemessa, 'light-green-100':documento.documentoAvulsoRemessa}">

        <div fxLayout="row" fxLayoutAlign="start center">
            <mat-icon *ngIf="!documento.documentoAvulsoRemessa" class="ml-8 mr-8">picture_as_pdf</mat-icon>
            <mat-icon *ngIf="documento.documentoAvulsoRemessa" class="ml-8 mr-8">mail</mat-icon>
            <div class="mr-8">{{documento.tipoDocumento?.sigla || 'OUT'}}</div>
            <mat-icon *ngIf="documento.documentoAvulsoRemessa && !documento.documentoAvulsoRemessa.dataHoraRemessa"
                      class="ml-8 mr-8">edit
            </mat-icon>
            <mat-icon
                *ngIf="documento.documentoAvulsoRemessa && documento.documentoAvulsoRemessa.dataHoraRemessa && !documento.documentoAvulsoRemessa.dataHoraResposta"
                class="ml-8 mr-8">screen_share
            </mat-icon>
            <mat-icon *ngIf="documento.documentoAvulsoRemessa && documento.documentoAvulsoRemessa.dataHoraResposta"
                      class="ml-8 mr-8">reply
            </mat-icon>
            <mat-icon *ngIf="documento.assinado" class="ml-8 mr-8">lock</mat-icon>
            <mat-icon *ngIf="documento.apagadoEm" class="ml-8 mr-8">delete</mat-icon>
        </div>

        <div class="space" fxLayout="row" fxLayoutAlign="start center">
        </div>

    </div>

    <div class="more-vert"
         [ngClass]="{'light-blue-100':!documento.documentoAvulsoRemessa, 'light-green-100':documento.documentoAvulsoRemessa}">
        <button *ngIf="!deleting && !assinando && !convertendo && !removendoAssinatura && !alterando && !maisDeUmItemSelecionado" mat-icon-button
                [matMenuTriggerFor]="menuDocumento" #menuTrigger="matMenuTrigger" aria-label="more">
            <mat-icon>expand_more</mat-icon>
        </button>

        <div *ngIf="deleting || assinando || convertendo || removendoAssinatura || alterando" class="spinner-container m-8">
            <mat-spinner diameter="24"></mat-spinner>
        </div>

        <mat-menu #menuDocumento="matMenu">
            <ng-template [ngIf]="!documento.apagadoEm">
                <button
                    *ngIf="(!documento.documentoAvulsoRemessa || !documento.documentoAvulsoRemessa.dataHoraRemessa) && this._loginService.isGranted('ROLE_COLABORADOR')"
                    fxLayout="row" fxLayoutAlign="start center" (click)="doDelete(documento.id)" mat-menu-item>
                    <mat-icon color="accent">delete</mat-icon>
                    <span>Apagar Minuta</span>
                </button>
                <button fxLayout="row" fxLayoutAlign="start center" (click)="doAssinatura(documento.id)" mat-menu-item>
                    <mat-icon color="accent">lock</mat-icon>
                    <span>Assinar</span>
                </button>
                <button fxLayout="row" fxLayoutAlign="start center" (click)="doRemoveAssinatura(documento.id)" mat-menu-item
                        *ngIf="documento.assinado && _loginService.isGranted('ROLE_COLABORADOR')">
                    <mat-icon color="accent">lock_open</mat-icon>
                    <span>Remover Assinatura</span>
                </button>
                <button fxLayout="row" fxLayoutAlign="start center" (click)="doConverte(documento.id)" mat-menu-item>
                    <mat-icon color="accent">picture_as_pdf</mat-icon>
                    <span>Converter em PDF</span>
                </button>
                <button *ngIf="documento.documentoAvulsoRemessa && documento.documentoAvulsoRemessa.dataHoraResposta"
                        fxLayout="row" fxLayoutAlign="start center"
                        (click)="doVerResposta(documento.documentoAvulsoRemessa.documentoResposta)" mat-menu-item>
                    <mat-icon color="accent">picture_as_pdf</mat-icon>
                    <span>Ver Resposta</span>
                </button>
                <button fxLayout="row" fxLayoutAlign="start center"
                        *showIfRole="'ROLE_COLABORADOR'"
                        [matMenuTriggerFor]="tipoDocumentoMenu" mat-menu-item>
                    <mat-icon color="accent">edit</mat-icon>
                    <span>Alterar Tipo de Documento</span>
                </button>
            </ng-template>
            <ng-template [ngIf]="documento.apagadoEm">
                <button fxLayout="row" fxLayoutAlign="start center" (click)="doRestaurar(documento.id)" mat-menu-item>
                    <mat-icon color="accent">undo</mat-icon>
                    <span>Restaurar</span>
                </button>
            </ng-template>

        </mat-menu>
    </div>

    <mat-menu #tipoDocumentoMenu="matMenu" class="menuTipoDocumento" id="testeMenu">
        <form class="p-8 mb-8" fxLayoutGap="16px" fxLayout="column" fxLayoutAlign="start"
              fxFlex="1 0 auto" name="form" [formGroup]="form" (click)="$event.stopPropagation()">
            <mat-form-field fxFlex="100">
                <div fxLayout="row" fxLayoutAlign="start center">
                    <input mat-menu-item matInput placeholder="Tipo de Documento"
                           formControlName="tipoDocumento"
                           [matAutocomplete]="tipoDocumento.autocomplete"
                           (blur)="checkTipoDocumento()">
                </div>
                <cdk-tipo-documento-autocomplete
                    #tipoDocumento="tipoDocumentoAutocomplete"
                    [control]="form.get('tipoDocumento')"
                    [pagination]="tipoDocumentoPagination">
                </cdk-tipo-documento-autocomplete>
                <mat-error *ngIf="form.get('tipoDocumento').hasError('formError')">
                    {{form.get('tipoDocumento').errors.formError}}
                </mat-error>
            </mat-form-field>
            <button mat-raised-button color="accent" (click)="salvarTipoDocumento(documento)">
                SALVAR
            </button>
        </form>
    </mat-menu>

    <div class="card-divider full-width"></div>

    <div class="p-8" fxLayout="row" fxLayoutAlign="end center" fxHide>

        <button mat-button color="accent">
            <mat-icon class="secondary-text">delete</mat-icon>
        </button>
    </div>

</div>

